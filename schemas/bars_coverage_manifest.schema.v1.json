{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/JSunRae/ml-contracts/schemas/bars_coverage_manifest.schema.v1.json",
  "title": "Bars Coverage Manifest (v1) Snapshot",
  "description": "Snapshot of v1 bars coverage manifest schema.",
  "type": "object",
  "$defs": {
    "isoTimestampLoose": {
      "description": "ISO-like timestamp (naive or TZ-aware).",
      "type": "string",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(?:\\.\\d+)?(?:Z|[+-]\\d{2}:\\d{2})?$"
    },
    "ymd": { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}$" },
    "day": {
      "type": "object",
      "required": ["date", "path", "filename", "rows"],
      "properties": {
        "date": { "$ref": "#/$defs/ymd" },
        "time_start": { "$ref": "#/$defs/isoTimestampLoose" },
        "time_end": { "$ref": "#/$defs/isoTimestampLoose" },
        "path": { "type": "string" },
        "filename": { "type": "string" },
        "rows": { "type": "integer", "minimum": 0 }
      },
      "additionalProperties": true
    },
    "total": {
      "type": "object",
      "required": ["date_start", "date_end"],
      "properties": {
        "date_start": { "$ref": "#/$defs/ymd" },
        "date_end": { "$ref": "#/$defs/ymd" }
      },
      "additionalProperties": false
    },
    "entry": {
      "type": "object",
      "required": ["symbol", "bar_size", "total", "days"],
      "properties": {
        "symbol": { "type": "string" },
        "bar_size": { "type": "string", "enum": ["1 hour", "1 min", "1 sec"] },
        "total": { "$ref": "#/$defs/total" },
        "days": { "type": "array", "items": { "$ref": "#/$defs/day" } }
      },
      "additionalProperties": true
    }
  },
  "required": ["schema_version", "generated_at", "entries"],
  "properties": {
    "schema_version": { "const": "bars_coverage.v1" },
    "generated_at": { "$ref": "#/$defs/isoTimestampLoose" },
    "entries": { "type": "array", "items": { "$ref": "#/$defs/entry" } }
  },
  "additionalProperties": true
}
